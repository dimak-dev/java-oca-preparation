= Working with Java API - String, StringBuilder
:toc:
:toc-title: Содержание
:toclevels: 3

== Назначение

Тема "Working with Java API - String, StringBuilder" является критически важной для экзамена OCA Java SE 8 и практической работы с текстовыми данными.
Понимание различий между неизменяемыми строками (String) и изменяемыми строковыми буферами (StringBuilder) необходимо
для написания эффективного кода, работы с пулом строк и избежания проблем с производительностью.
Правильное использование методов для работы с текстовыми данными является основой многих приложений на Java.

== Теория

=== Класс String и неизменяемость

Строки в Java являются неизменяемыми (immutable) объектами. Это означает, что после создания объекта String его содержимое нельзя изменить.

**Ключевые характеристики String:**

* Все объекты String неизменяемы
* Любые операции "изменения" создают новый объект String
* String является final классом (нельзя наследовать)
* Строки хранятся в специальном пуле строк (String Pool)
* Потокобезопасны благодаря неизменяемости

**Последствия неизменяемости:**

[source,java]
----
String str = "Hello";
str = str + " World"; // Создается новый объект, старый остается в памяти
----

При множественных конкатенациях это может привести к проблемам с производительностью и памятью.

=== String Pool (пул строк)

String Pool - это специальная область в куче, где хранятся уникальные строковые литералы для экономии памяти.

**Правила работы с пулом:**

* Строковые литералы автоматически помещаются в пул
* Одинаковые литералы ссылаются на один объект в пуле
* `new String()` всегда создает новый объект вне пула
* Метод `intern()` принудительно помещает строку в пул

**Пример:**
[source,java]
----
String s1 = "Hello";        // В пуле
String s2 = "Hello";        // Ссылка на тот же объект в пуле
String s3 = new String("Hello"); // Новый объект вне пула
String s4 = s3.intern();    // Ссылка на объект в пуле

System.out.println(s1 == s2); // true
System.out.println(s1 == s3); // false
System.out.println(s1 == s4); // true
----

=== Основные методы String

String предоставляет множество методов для работы с текстом:

**Методы получения информации:**

* `length()` - длина строки
* `isEmpty()` - проверка на пустоту
* `charAt(int index)` - символ по индексу

**Методы поиска:**

* `indexOf(String/char)` - поиск подстроки/символа
* `lastIndexOf(String/char)` - поиск с конца
* `contains(String)` - проверка содержания
* `startsWith(String)`, `endsWith(String)` - проверка начала/конца

**Методы преобразования (создают новые объекты):**

* `toUpperCase()`, `toLowerCase()` - изменение регистра
* `trim()` - удаление пробелов с краев
* `substring(int start, int end)` - извлечение подстроки
* `replace(char/String old, char/String new)` - замена символов/подстрок

=== Класс StringBuilder

StringBuilder представляет изменяемую последовательность символов и предназначен для эффективной работы со строками.

**Ключевые характеристики StringBuilder:**

* Изменяемый (mutable) - содержимое можно модифицировать
* Эффективен для множественных операций со строками
* Автоматически расширяет внутренний буфер при необходимости
* НЕ потокобезопасен (для многопоточности используйте StringBuffer)

**Внутренняя структура:**

StringBuilder использует внутренний массив символов с начальной емкостью (capacity).
Когда емкость исчерпывается, создается новый массив большего размера.

=== Основные методы StringBuilder

**Конструкторы:**
[source,java]
----
StringBuilder sb1 = new StringBuilder();           // Емкость 16
StringBuilder sb2 = new StringBuilder(50);         // Указанная емкость
StringBuilder sb3 = new StringBuilder("Hello");    // На основе строки
----

**Методы добавления:**

* `append(String/char/int/...)` - добавление в конец
* `insert(int index, String/char/...)` - вставка по индексу

**Методы удаления и изменения:**

* `delete(int start, int end)` - удаление подстроки
* `deleteCharAt(int index)` - удаление символа
* `replace(int start, int end, String str)` - замена подстроки
* `reverse()` - обращение строки

**Методы получения информации:**

* `length()` - текущая длина
* `capacity()` - емкость буфера
* `charAt(int index)` - символ по индексу
* `toString()` - преобразование в String

== Примеры кода

=== Пример 1: Неизменяемость строк и основные методы

Класс `StringBuilderDemo` демонстрирует концепцию неизменяемости строк:

[source,java]
----
include::../../src/com/ru/oca/string/StringBuilderDemo.java[lines=12..38]
----

**Ключевые аспекты:**

* Демонстрация того, как "изменение" строки создает новый объект
* Показ влияния на производительность при множественных конкатенациях
* Понимание различий между ссылками и содержимым объектов

=== Пример 2: String Pool и методы String

Демонстрация работы с пулом строк и основными методами:

[source,java]
----
include::../../src/com/ru/oca/string/StringBuilderDemo.java[lines=43..105]
----

**Ключевые аспекты:**

* Основные методы для работы с текстом
* Понимание принципов работы String Pool
* Различия между == и equals() для строк
* Использование intern() для работы с пулом

=== Пример 3: StringBuilder для эффективной работы

Использование StringBuilder для эффективных операций со строками:

[source,java]
----
include::../../src/com/ru/oca/string/StringBuilderDemo.java[lines=110..160]
----

**Ключевые аспекты:**

* Эффективное создание и модификация строк
* Управление емкостью буфера
* Различия в производительности между String и StringBuilder
* Основные методы StringBuilder

== Примеры вопросов

=== Вопрос 1
Что будет выведено следующим кодом?
[source,java]
----
String s1 = "Java";
String s2 = "Java";
String s3 = new String("Java");
System.out.println(s1 == s2);
System.out.println(s1 == s3);
----

* A) true, true ❌ НЕВЕРНО
* B) true, false ✓ ПРАВИЛЬНО
* C) false, true ❌ НЕВЕРНО
* D) false, false ❌ НЕВЕРНО

*Правильный ответ:* B - Строковые литералы помещаются в пул и ссылаются на один объект, но `new String()` создает новый объект.

=== Вопрос 2
Какой результат выполнения следующего кода?
[source,java]
----
StringBuilder sb = new StringBuilder("Hello");
sb.append(" World").delete(5, 6);
System.out.println(sb);
----

* A) Hello World ❌ НЕВЕРНО
* B) HelloWorld ✓ ПРАВИЛЬНО
* C) Hello ❌ НЕВЕРНО
* D) Ошибка компиляции ❌ НЕВЕРНО

*Правильный ответ:* B - append добавляет " World", затем delete удаляет символ по индексу 5 (пробел).

=== Вопрос 3
Что происходит с производительностью при выполнении множественных конкатенаций String?

* A) Производительность улучшается ❌ НЕВЕРНО
* B) Производительность не изменяется ❌ НЕВЕРНО
* C) Производительность ухудшается из-за создания множества объектов ✓ ПРАВИЛЬНО
* D) Происходит ошибка компиляции ❌ НЕВЕРНО

*Правильный ответ:* C - Каждая конкатенация String создает новый объект, что приводит к неэффективному использованию памяти.

== Типичные ошибки

=== Ошибка 1: Неэффективное использование String для множественных операций

Использование String для множественных конкатенаций:
[source,java]
----
String result = "";
for (int i = 0; i < 1000; i++) {
    result += i; // НЕЭФФЕКТИВНО! Создается 1000 объектов
}
----

**Решение:** Используйте StringBuilder для множественных операций:
[source,java]
----
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 1000; i++) {
    sb.append(i);
}
String result = sb.toString();
----

=== Ошибка 2: Путаница между == и equals() для строк

Сравнение строк по ссылке вместо содержимого:
[source,java]
----
String s1 = new String("Hello");
String s2 = new String("Hello");
if (s1 == s2) { // ОШИБКА! Сравнивает ссылки
    System.out.println("Равны");
}
----

**Решение:** Используйте equals() для сравнения содержимого:
[source,java]
----
if (s1.equals(s2)) { // Правильно - сравнивает содержимое
    System.out.println("Равны");
}
----

=== Ошибка 3: Забывание о неизменяемости String

Ожидание изменения исходной строки:
[source,java]
----
String text = "hello world";
text.toUpperCase(); // ОШИБКА! Результат не сохраняется
System.out.println(text); // Выведет "hello world"
----

**Решение:** Сохраняйте результат операций String:
[source,java]
----
String text = "hello world";
text = text.toUpperCase(); // Сохраняем результат
System.out.println(text); // Выведет "HELLO WORLD"
----

== Связанные API

* `String` - класс для работы с неизменяемыми строками
* `StringBuilder` - класс для эффективной работы с изменяемыми строками
* `StringBuffer` - потокобезопасная версия StringBuilder
* `CharSequence` - интерфейс, реализуемый String и StringBuilder

== Связанные темы

* xref:../java-data-types/index.adoc[Working with Java Data Types]
* xref:../methods/index.adoc[Working with Methods]
* xref:../arraylist/index.adoc[Working with Java API - ArrayList]
* xref:../loops/index.adoc[Using Loop Constructs]
